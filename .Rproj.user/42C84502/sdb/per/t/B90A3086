{
    "collab_server" : "",
    "contents" : "# County-level oil and gas production\n# Group Member: Mengze Yin, Tianchi Zhang, Yilin Li\n# Objective of this project : \n# Discover the relationship between population level and oil and gas production\n\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(readr)\nlibrary(data.table)\nlibrary(doBy)\n\n# Part 1. Tidy Data\n\n# Read file \"Oilgascounty.csv\" (Reference: www.ers.usda.gov)\nraw <- read.csv(\"oilgascounty.csv\",stringsAsFactors = FALSE)\nraw <- raw[, c(\"FIPS\",\"geoid\",\"Stabr\",\"County_Name\",\"Rural_Urban_Continuum_Code_2013\",\"Urban_Influence_2013\",\"Metro_Nonmetro_2013\",\"Metro_Micro_Noncore_2013\",\"oil2000\",\"oil2001\",\"oil2002\",\"oil2003\",\"oil2004\",\"oil2005\",\"oil2006\",\"oil2007\",\"oil2008\",\"oil2009\",\"oil2010\",\"oil2011\",\"gas2000\",\"gas2001\",\"gas2002\",\"gas2003\",\"gas2004\",\"gas2005\",\"gas2006\",\"gas2007\",\"gas2008\",\"gas2009\",\"gas2010\",\"gas2011\",\"oil_change_group\",\"gas_change_group\",\"oil_gas_change_group\")]\n\n# Extract column names in order to revise them \nnames(raw)[3] <- \"State\"\nnames(raw)[4] <- \"County\"\nnames(raw)[5] <- \"Population_Level\"\nnames(raw)[6] <- \"Urban_Influence\"\nnames(raw)[7] <- \"If_Metro\"\nnames(raw)[8] <- \"Metro_Micro_Noncore\"\nraw\n\n# Split the table into two because there are multiple types in one table: County & Oil and Gas Production\n# Create two tables\n\n# Select the information of County to form a new table  \ncounty <- raw %>% \n  select(FIPS, State, County,Population_Level,Urban_Influence, If_Metro,Metro_Micro_Noncore) %>%\n  unique() %>%\n  mutate(county_id = row_number())\n\n# To reduce repetition and enhance readability, eliminate the word \"County\" from the County column\ncounty$County <- sub(\"County\",\"\",county$County)\ncounty\n\n\n# Select the information of Oil and Gas Production for each county to form a new table\noil_gas0 <- raw %>% \n  select(FIPS, oil2000,oil2001,oil2002,oil2003,oil2004,oil2005,oil2006,oil2007,oil2008,oil2009,oil2010,oil2011,gas2000,gas2001,gas2002,gas2003,gas2004,gas2005,gas2006,gas2007,gas2008,gas2009,gas2010,gas2011) %>%\n  unique() %>%\n  mutate()\n\n# Because column headers include values (oil/gas + year, eg: oil2003), we melted the column heads into rows \n# First, gather up the non-variable columns\noil_gas1 <- oil_gas0 %>% \n  gather(demo, n, -FIPS, na.rm = TRUE)\n\n# Second, seperate column headers\noil_gas_tidy <- oil_gas1 %>% \n  separate(demo, c(\"production\", \"year\"), 3)\n\n\n\n\n# Part 2. Data Summary\n\n# (1) average annual oil and gas production for each county\ndemo1 <- which(colnames(raw)==\"oil2000\")\ndemo2 <- which(colnames(raw)==\"oil2011\")\ndemo3 <- which(colnames(raw)==\"gas2000\")\ndemo4 <- which(colnames(raw)==\"gas2011\")\nraw$mean_oil_production <- rowSums(raw[demo1:demo2])/12\nraw$mean_gas_production <- rowSums(raw[demo3:demo4])/12\n\nmean_county_production <- raw %>% \n  select(FIPS,Population_Level, oil_production, gas_production) %>%\n  unique() %>%\n  mutate(county_id = row_number())\n\n\n# (2) nationalwide mean production (per county) in each year to compare nationwide oil and gas production\n# nationalwide oil production\nmean_oil <- colMeans(raw[9:20], na.rm = FALSE, dims =1L)\nmean_oil <- data_frame(year=c(2000:2011),mean_oil=mean_oil)\n\n# nationalwide gas production\nmean_gas <- colMeans(raw[21:32], na.rm = FALSE, dims =1L)\nmean_gas <- data_frame(year=c(2000:2011),mean_gas=mean_gas)\n\n# Merge two tables into one for future visulization\nnational_mean_production <- merge(mean_oil,mean_gas,by=\"year\")\nnames(national_mean_production)[2] <- \"typeoil\"\nnames(national_mean_production)[3] <- \"typegas\"\nnational_mean_production <- national_mean_production %>%\n  gather(type,amount,typeoil:typegas) %>%\n  mutate(type = gsub(\"type\",\"\",type)) %>%\n  arrange(year, type)\n\n\n# (3) average oil and gas production for counties by each population level \n# Select the information of population level,Oil and Gas Production for each county to form a new table\nCounty_Level_Mean <- raw %>% \n  select(Population_Level, oil2000,oil2001,oil2002,oil2003,oil2004,oil2005,oil2006,oil2007,oil2008,oil2009,oil2010,oil2011,gas2000,gas2001,gas2002,gas2003,gas2004,gas2005,gas2006,gas2007,gas2008,gas2009,gas2010,gas2011) %>%\n  mutate()\n\n# Get the average county oil and gas production for each population level in each year\nCounty_Level_Mean <- aggregate(County_Level_Mean[,2:25],list(County_Level_Mean$Population_Level), mean)\nnames(County_Level_Mean)[1] <- paste(\"County_Level\")\nCounty_Level_Mean\n\n# Tidy the table \nCounty_Level_Mean0 <- County_Level_Mean %>%\n  gather(demo, amount, -County_Level, na.rm = TRUE)\n\nCounty_Level_Mean_tidy <- County_Level_Mean0 %>% \n  separate(demo, c(\"production\", \"year\"), 3)\n\n# Create a table with county, county level defined by population, sum of oil production in 12 years and sum of gas production in 12 years\ncounty_production <- raw %>% \n  select(FIPS,Population_Level, mean_oil_production, mean_gas_production) %>%\n  unique() %>%\n  mutate(county_id = row_number())\ncounty_production\n\n# Create a table with the mean oil production for each county level in each year\nCounty_Level_Mean_Oil <- County_Level_Mean %>%\n  gather(oil,oil_production_mean, oil2000:oil2011, na.rm = TRUE) %>%\n  mutate(year = parse_number(oil))%>%\n  select(County_Level, year, oil_production_mean) %>%\n  unique() %>%\n  mutate()\n# Create a table with the mean gas production for each county level in each year\nCounty_Level_Mean_Gas <- County_Level_Mean %>%\n  gather(gas,gas_production_mean, gas2000:gas2011, na.rm = TRUE) %>%\n  mutate(year = parse_number(gas))%>%\n  select(County_Level, year, gas_production_mean) %>%\n  unique() %>%\n  mutate()\n\n\n\n\n# Part 3. Visualization\nrequire(ggplot2) \n\n# 1\n# ggplot for \"Relationship between Oil Production and Gas Production from 2000-2011\" \nggplot(data=national_mean_production, aes(x=factor(year), y=amount, fill=type)) +\n  geom_bar(stat=\"identity\", position =position_dodge())+\n  xlab(\"Year\")+\n  ylab(\"Production\")+\n  ggtitle(\"Oil Production vs. Gas Production\")+\n  scale_y_continuous(breaks=seq(0, 8000000, 1000000))\n\n# 2\n# ggplot for \"Oil Production for each County Level\"\nggplot(data = county_production, aes(factor(Population_Level),mean_oil_production,fill=factor(Population_Level)))  +\n  geom_bar(stat = \"identity\")+\n  xlab(\"County Level\")+\n  ylab(\"Mean Oil Production\")+\n  labs(fill=\"County Level\")+\n  scale_y_continuous(breaks=seq(0, 1200000000, 50000000))+\n  ggtitle(\"Oil Production By County Level\")\n\n# ggplot for \"Gas Production for each County Level\"\nggplot(data = county_production, aes(factor(Population_Level),mean_gas_production,fill=factor(Population_Level)))  +\n  geom_bar(stat = \"identity\")+\n  xlab(\"County Level\")+\n  ylab(\"Mean Gas Production\")+\n  labs(fill=\"County Level\")+\n  scale_y_continuous(breaks=seq(0, 12000000000, 500000000))+\n  ggtitle(\"Gas Production By County Level\")\n\n# 3 Scatter Plot\nggplot(county_production, aes(x = factor(Population_Level), y = mean_oil_production))+\n  geom_point(aes(color = Population_Level))+\n  scale_y_continuous(limits = c(0, 2*10^7))+\n  xlab(\"County Level\")+\n  ylab(\"Oil Production\")+\n  ggtitle(\"oil Production of Each County in Different County Level\")\n\n# 4\n# ggplot for \"Annual Oil Production for each County Level\"\nggplot(data = County_Level_Mean_Oil, aes(x = factor(year), y = oil_production_mean,colour = County_Level)) +       \n  xlab(\"Year\")+\n  ylab(\"Mean Oil Production\")+\n  ggtitle(\"Oil Production By Year\")+\n  geom_line(aes(group = County_Level)) + geom_point()+\n  scale_y_continuous(breaks=seq(0, 12000000, 200000))+\n  scale_colour_gradient(low = 'lightblue', high = 'darkblue', breaks=c(1:9))\n\n# ggplot for \"Annual Oil Production for each County Level\"\nggplot(data = County_Level_Mean_Gas, aes(x = factor(year), y = gas_production_mean,colour = County_Level)) +       \n  xlab(\"Year\")+\n  ylab(\"Mean Gas Production\")+\n  ggtitle(\"Gas Production By Year\")+\n  geom_line(aes(group = County_Level)) + geom_point()+\n  scale_y_continuous(breaks=seq(0, 120000000, 2000000))+\n  scale_colour_gradient(low = 'lightblue', high = 'darkblue', breaks=c(1:9))\n\n",
    "created" : 1477286290800.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3159972045",
    "id" : "B90A3086",
    "lastKnownWriteTime" : 1477340515,
    "last_content_update" : 1477340515,
    "path" : "E:/2016 Fall/MA415/Midterm Project Oil Gas Production/Midterm Project.R",
    "project_path" : "Midterm Project.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}